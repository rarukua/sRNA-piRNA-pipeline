// ============================================================
// nextflow.config — Pipeline configuration
// ============================================================

// --- Default parameters (all overridable on CLI) ---
params {
    // Input
    samplesheet     = "assets/samplesheet.csv"

    // Reference files — override with your actual paths
    genome_dir      = "/path/to/STAR_genome_index"    // for STAR
    bowtie2_index   = "/path/to/bowtie2_index/genome" // for Bowtie2
    bowtie1_index   = "/home/zgao/GEOdata/bowtie1_index/hg38" // for Bowtie1 // for Bowtie2 (prefix)
    gtf             = "/path/to/piRbase_cluster_GTF.gtf"

    // Aligner selection: 'star' or 'bowtie2'
    aligner         = "star"

    // Fastp: piRNA size selection
    // Your original used --max_len1 24 (keeping reads ≤24 nt)
    max_len         = 24

    // STAR-specific piRNA params (mirrored from your original code)
    star_mismatch   = 0        // --outFilterMismatchNmax
    star_multimap   = 1000000  // --outFilterMultimapNmax
    star_min_match  = 22       // --outFilterMatchNmin

    // Bowtie2-specific piRNA params
    bowtie2_n_ceil  = 0        // no mismatches (--score-min equivalent)

    // featureCounts piRNA params
    min_overlap     = 22       // --minOverlap
    fc_feature_type = "piRbase" // -t (feature type in GTF)

    // Pipeline mode: 'qc_only' or 'full'
    mode            = "full"

    // Output directory
    outdir          = "results"

    // MultiQC
    multiqc_title   = "piRNA Pipeline QC Report"
}

// --- Execution profiles ---
profiles {

    // Standard: run with locally installed tools (no container)
    standard {
        process.executor = 'local'
    }

    // Docker profile
    docker {
        docker.enabled         = true
        docker.runOptions      = '-u $(id -u):$(id -g)'
        process.container      = 'zgao/pirna-pipeline:latest'
    }

    // Singularity profile (preferred on HPC/shared Linux servers)
    singularity {
        singularity.enabled    = true
        singularity.autoMounts = true
        process.container      = 'docker://zgao/pirna-pipeline:latest'
    }

    // Test profile: tiny dataset for quick validation
    test {
        params.samplesheet   = "assets/samplesheet_test.csv"
        params.genome_dir    = "test_data/star_index"
        params.bowtie2_index = "test_data/bowtie2_index/genome"
        params.gtf           = "test_data/test_annotation.gtf"
        params.outdir        = "test_results"
    }
}

// --- Resource configuration ---
process {
    cpus   = 4
    memory = '8 GB'
    time   = '2h'

    withName: 'STAR_ALIGN' {
        cpus   = 16
        memory = '32 GB'
        time   = '4h'
    }

    withName: 'BOWTIE2_ALIGN' {
        cpus   = 8
        memory = '16 GB'
        time   = '4h'
    }

    withName: 'FEATURECOUNTS' {
        cpus   = 4
        memory = '8 GB'
    }
}

// --- Nextflow execution settings ---
executor {
    queueSize = 10
}

// --- Report generation ---
report {
    enabled = true
    file    = "${params.outdir}/pipeline_report.html"
}

timeline {
    enabled = true
    file    = "${params.outdir}/pipeline_timeline.html"
}

dag {
    enabled = true
    file    = "${params.outdir}/pipeline_dag.html"
}
